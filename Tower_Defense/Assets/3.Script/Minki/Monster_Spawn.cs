using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Mirror;
using Pathfinding;

public class Monster_Spawn : NetworkBehaviour
{
    /*
        몬스터 스폰 및 오브젝트 풀링 스크립트
        1. 플레이어 프리팹에 있는 스폰 포인트의 랜덤 구역에서 몬스터 스폰
        2. 리스트에 담아놓고 비활성화 되어있는 몬스터가 있으면 해당 몬스터를 활성화하면서 스폰
    */

    public Transform[] SpawnPoint;
    public Transform[] FinPoint;

    [SerializeField] private GameObject[] Mon_Prefabs;
    [SerializeField] private GameObject[] test_Build;

    #region Unity Callback
    #endregion
    #region SyncVar
    #endregion
    #region Client
    [Client]
    public void Onclick(int index)
    {
        CMD_SpawnMonster(index, (int)GameManager.instance.Player_Num);
    }
    #endregion
    #region Command
    [Command(requiresAuthority = false)]
    private void CMD_SpawnMonster(int index, int player_num)
    {
        // 초기화 메소드 가져와야됨
        Transform spawnpoint = Get_SpawnPoint(player_num);
        GameObject monster = Instantiate(Mon_Prefabs[index], spawnpoint.position, Quaternion.identity);
        NetworkServer.Spawn(monster);

        // 태그 할당
        monster.tag = $"{player_num}P";

        Monster_Movement move = monster.GetComponent<Monster_Movement>();
        Transform finpoint = Get_FinPoint(player_num);
        move.Astar.target = finpoint;
        Rpc_SpawnMonster(monster, player_num);
    }
    #endregion
    #region ClientRPC
    [ClientRpc]
    private void Rpc_SpawnMonster(GameObject mon, int player_num)
    {
        if (!isServer)
        {
            // 태그 할당
            mon.tag = $"{player_num}P";
        }
    }
    #endregion
    #region Hook Method
    #endregion

    private Transform Get_SpawnPoint(int player_num)
    {
        switch(player_num)
        {
            /*
                나중에 플레이어 목숨 다하면 다음 플레이어로 소환하는 로직 필요함 Todo 
            */
            case 1:
                return SpawnPoint[1];
            case 2:
                return SpawnPoint[2];
            case 3:
                return SpawnPoint[3];
            case 4:
                return SpawnPoint[0];
            default:
                return null;
        }
    }
    private Transform Get_FinPoint(int player_num)
    {
        switch (player_num)
        {
            /*
                나중에 피니시라인 넘어갔을 때 그 다음 플레이어에게 가는 로직 필요함 Todo
            */
            case 1:
                return FinPoint[1];
            case 2:
                return FinPoint[2];
            case 3:
                return FinPoint[3];
            case 4:
                return FinPoint[0];
            default:
                return null;
        }
    }
}
